@{
    ViewBag.Title = "支付信息";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section styles{

    <style type="text/css">
        .operate-result {
            padding: 0 1rem;
        }

        .operate-result .imgbox {
            text-align: center;
            margin-top: 4rem;
        }

        .operate-result .imgbox img {
            width: 100px;
            display: inline-block;
        }

        .operate-result .item-message {
            text-align: center;
            margin-top: 1rem;
        }

        .operate-result .item-message span {
            font-size: 1.2rem;
            line-height: 3rem;
            color: #ff6c8d;
        }

        .operate-result .item-remarks {
            margin-top: 1rem;
        }

        .operate-result .item-remarks p {
            font-size: .9rem;
            line-height: 1.4rem;
        }

        .operate-result .item-btn {
            display: flex;
            padding: 10px 0px;
        }

        .operate-result .item-btn .btnbox {
            flex: 1;
            text-align: center;
        }

        .operate-result .btn {
            border: 1px solid #000;
            border-radius: 18px;
            padding: 4px 20px;
            display: inline-block;
            font-size: 14px;
        }


        .result-check .it-message {
            text-align: center;
            font-size: .8rem;
            color: #333;
        }

        .redCountdownDays, .redCountdownHours, redCountdownMinutes {
            display: none;
        }
    </style>
}

@section scripts{
    <script src="~/Scripts//jquery.knob.min.js"></script>
    <script src="~/Scripts/jquery.ba-throttle-debounce.min.js"></script>
    <script src="~/Scripts/jquery.redcountdown.js?@DateTime.Now.ToString("yyyyMMddHHmmss")"></script>
    <script type="text/javascript">


        var orderId = "@Request.QueryString["orderId"]";

        $(document).ready(function () {

            $('#rC_PB').redCountdown({ preset: "flat-colors-fat", end: $.now() + 120, labels: false });

            var myInterval = setInterval(function () {
                $.lumos.get({
                    url: "/Order/GetPayResult?orderId=" + orderId,
                    isShowLoading: false,
                    success: function (d) {
                        if (d.result == $.lumos.resultType.success) {
                            if (d.code == 8003) {
                                clearInterval(myInterval);
                            }

                            $('#block_check').hide();
                            if ($('#block_area').find('.operate-result').length < 1) {
                                $("#block_tmpl").tmpl(d.data).appendTo('#block_area');
                            }

                        }
                    }
                });
            }, 1000);

            //var rt = JSON.parse(sessionStorage.getItem("payResult"));
            //$("#block_tmpl").tmpl(rt).appendTo('#block_area');
        });
    </script>
}

<div id="block_check" class="result-check">
    <div class="it-countdown" id="rC_PB" style="text-align:center;"></div>
    <div class="it-message">
        <span>正在查询订单信息，请耐心等候</span>
    </div>
</div>

<script id="block_tmpl" type="text/x-jquery-tmpl">
    <div class="operate-result">
        <div class="item-result">
            <div class="imgbox">
                <img src="/Content/default/images/operate-result-icon-success.png" />
            </div>
        </div>
        <div class="item-message">
            <span>${message}</span>
        </div>
        <div class="item-btn">
            {{each(j,btn) buttons}}
            <div class="btnbox">
                <a href="${btn.url}" class="btn" style="color:${btn.color}; border:1px solid ${btn.color} ;">${btn.name}</a>
            </div>
            {{/each}}
        </div>
        <div class="item-remarks">
            <p>${remarks}</p>
        </div>


        <div class="its-a">
            {{each(j,field) fields}}

            <div class="it">

                <div class="it-m">
                    <div class="it-ml w100">
                        <text class='txt'>${field.name}</text>
                    </div>
                    <div class="it-mr flex1">
                        <text class='txt'>${field.value}</text>
                    </div>
                </div>
            </div>

            {{/each}}
        </div>


    </div>
</script>

<div id="block_area">

</div>
