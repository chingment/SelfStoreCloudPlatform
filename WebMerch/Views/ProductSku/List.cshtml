
@{
    ViewBag.Title = "List";
    Layout = "~/Views/Shared/_LayoutHomeIframeMainList.cshtml";
}

<script type="text/javascript">

    var listTable;

    $(document).ready(function () {


        listTable = $("#list_table").loadDataTable({
            url: "/ProductSku/GetList",
            pageIndex: 0,
            searchParams: $("#form1").serializeArray(),
            searchButtonId: "btn_Search",
            containerId: "form1",
            rowDataCombie: function (p_index, p_row) {
                var l_StrRows = "";
                l_StrRows += "<tr>";
                l_StrRows += "<td class=\"no\" >" + (p_index + 1) + "</td>";
                l_StrRows += "<td class=\"overflow tipitem\"><div> <img src=\"" + p_row.mainImg + "\" style=\"width:50px;height:50px\"><div></td>";
                l_StrRows += "<td class=\"overflow\" title=\"" + p_row.name + "\">" + p_row.name + "</td>";
                l_StrRows += "<td class=\"overflow\" title=\"" + p_row.kindNames + "\">" + p_row.kindNames + "</td>";
                l_StrRows += "<td class=\"overflow\" title=\"" + p_row.salePrice + "\"><a href=\"javascript:void(0)\" operate=\"editBySalePrice\"   class=\"a-btn a-btn-edit\"  >" + p_row.salePrice + "</a></td>";
                l_StrRows += "<td class=\"overflow\" title=\"" + p_row.showPrice + "\">" + p_row.showPrice + "</td>";
                l_StrRows += "<td class=\"operation\">";

                if (p_row.isDelete) {
                    l_StrRows += "<a href=\"javascript:void(0)\"  class=\"a-btn\" >已删除</a>";
                }
                else {
                    l_StrRows += "<a href=\"javascript:void(0)\" operate=\"edit\"   class=\"a-btn a-btn-edit\"  >修改</a>";
                }

                l_StrRows += "</td>";
                l_StrRows += "</tr>";
                return l_StrRows;
            },
            operate: {
                "delete": function (obj) {

                    $.lumos.postJson({
                        url: "/Biz/ProductSku/Delete",
                        data: { id: obj[0].id },
                        success: function (d) {
                            listTable.loadData(0);
                            $.lumos.tips(d.message);
                        }
                    });

                },
                "edit": function (obj) {
                    var url = '/ProductSku/Edit?id=' + obj.id;
                    var title = '商品信息修改';
                    var dialog = art.dialog.open(url, {
                        id: "openDialog", title: title, width: '800px', height: '600px', lock: true, drag: false, cancelVal: '关闭', cancel: true, okVal: '保存', ok: function () {
                            this.iframe.contentWindow.submit(function (d) {
                                if (d.result == $.lumos.resultType.success) {
                                    //dialog.close();
                                    listTable.loadData();
                                }
                                $.lumos.tips(d.message);
                            });
                            return false;
                        }
                    });
                },
                "editBySalePrice": function (obj) {
                    var url = '/ProductSku/EditBySalePrice?id=' + obj.id;
                    var title = '商品价格修改';
                    var dialog = art.dialog.open(url, {
                        id: "openDialog", title: title, width: '800px', height: '600px', lock: true, drag: false, cancelVal: '关闭', cancel: true
                    });
                }
            }
        });


        $("#btn_Add").click(function () {
            var url = '/ProductSku/Add';
            var title = '新建';
            var dialog = art.dialog.open(url, {
                id: "openDialog", title: title, width: '800px', height: '600px', lock: true, drag: false, cancelVal: '关闭', cancel: true,
                button: [{
                    name: '确定',
                    callback: function () {
                        this.iframe.contentWindow.submit(function (d) {
                            if (d.result == $.lumos.resultType.success) {
                                dialog.close();
                                listTable.loadData();
                            }
                            $.lumos.tips(d.message);
                        });
                        return false;
                    },
                    focus: true
                }]
            });
        });


        $('#ddl_ProductKind').chosen({
            width: '100%',
            search_contains: false,
            disable_search: false,
            display_selected_options:false,
            max_selected_options: 1
        });


    });


    function cnapsChange() {
        var account_city = $('#account_city').val();
        var bank_code = $('#bank_code').val();

        var cnaps_no = $("#cnaps_no").val();
        $('#cnaps_name_select').val('');
        var obj = document.getElementById("cnaps_name_select");
        obj.options.length = 0;
        $.ajax({
            url: ctx() + "/cnaps/cnapsBank?clscode=" + bank_code + "&citycode=" + account_city,
            dataType: "json",
            success: function (data) {
                obj.options.add(new Option('', ''));
                $.each(data.banklist, function (i, val) {
                    obj.options.add(new Option(val.BNKNAME, val.CNAPS));
                    if (cnaps_no == val.CNAPS) {
                        $("#cnaps_name_select").val(cnaps_no);
                        cnapsNameChange();
                    }
                });
                $('#cnaps_name_select').trigger("chosen:updated");//重置下拉框
                $('#cnaps_name_select').chosen();//下拉框检索框架
            }
        });
    }

</script>

<form id="form1" name="form1">
    @Html.AntiForgeryToken()
    <div class="search-bar">
        <div class="filter">
            <span class="filter-label">名称：</span>
            <span class="filter-input">

                <select id="ddl_ProductKind" data-placeholder="请选择" name="ddl.ProductKind" class="chosen-select" style="width: 325px;">

                    <option value="-1"></option>
                    <option value="1">&nbsp;机器自取</option>
                    <option value="2">&nbsp;快递专送</option>
                    <option value="3">&nbsp;快递专送</option>
                </select>

                <input type="text" class="input-control" name="Name" style="width:120px;" />
            </span>
        </div>
        <div class="filter"><input type="button" class="btn btn-search" id="btn_Search" value="查询" /> </div>

        <div class="filter" style="float:right">
            <input type="button" class="btn btn-add" id="btn_Add" value="新建" />
        </div>
    </div>
    <div class="list">
        <table id="list_table" class="list-tb" cellpadding="0" cellspacing="0">
            <thead>
                <tr>
                    <th style="width:5%" class="no">
                        序号
                    </th>
                    <th style="width:10%">
                        图片
                    </th>
                    <th style="width:15%">
                        名称
                    </th>
                    <th style="width:15%">
                        模块
                    </th>
                    <th style="width:15%">
                        销售价
                    </th>
                    <th style="width:15%">
                        展示价
                    </th>
                    <th style="width:15%" class="operation">
                        操作
                    </th>
                </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
                <tr>
                    <td colspan="7">
                        <div class="pull-left">
                            <span class="load-tip"></span>
                        </div>
                        <div class="pull-right pagination">
                            <div class="pagination-info">

                            </div>
                            <div class="pagination-index">

                            </div>
                            <div class="pagination-goto">

                            </div>
                        </div>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
</form>

